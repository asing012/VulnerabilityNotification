#!/usr/bin/env python3
# Fetch latest updated CVEs


import requests
import time
import os
from sendgrid import SendGridAPIClient
from sendgrid.helpers.mail import Mail
import dateutil.parser

#variables
cveList=[]
dateList=[]
referencesList=[]
summaryList=[]
#making API call
URL = "http://cve.circl.lu/api/last"
req = requests.get(url = URL)
data = req.json()
count = len(data)

#extracting published time, id, references, and summary
for i in range(0, count):
	cveList.append(data[i]['id'])
	referencesList.append(data[i]['references'])
	summaryList.append(data[i]['summary'])
	publishedTime = data[i]['Published']
#formatting date and appending in the dateList
	rawDate  = dateutil.parser.parse(publishedTime)
	finalDate  = rawDate.date()
	print(finalDate)
	dateList.append(finalDate)

print(cveList)
print('\n')
print(dateList)
print('\n')
print(referencesList)
print('\n')
print(summaryList)
# sending email
"""
message = Mail(
	from_email='akshayc_118@hotmail.com',
    	to_emails='asingh@denimgroup.com',
    	subject='Latest updated CVEs',
    	html_content='<Date>'+str(finalDate)+'<br>'+'CVE'+str(cveId)+'<br>'+'References'+str(references)+'<br>'+'Summary'+str(vulnSummary))
try:
    	sg = SendGridAPIClient(os.environ.get('SENDGRID_API_KEY'))
    	response = sg.send(message)
    	print(response.status_code)
except Exception as e:
    	print(e.message)
"""

#print(data)
